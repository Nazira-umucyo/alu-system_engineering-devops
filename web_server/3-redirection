#!/usr/bin/env bash
# Sets up a 301 redirect for /redirect_me on a new Ubuntu server

# Exit immediately if any command fails
set -e

# Install nginx if not already installed
apt-get update -y
apt-get install -y nginx

# Define config file
NGINX_DEFAULT="/etc/nginx/sites-available/default"

# Insert the redirection block into the server block, after the 'listen' line
sed -i "/listen 80 default_server;/a \\\n\tlocation /redirect_me {\n\t\treturn 301 https://www.youtube.com/watch?v=QH2-TGUlwu4;\n\t}" "$NGINX_DEFAULT"

# Restart nginx to apply changes
service nginx restart
