#!/usr/bin/env bash
# Fixes Nginx to listen on port 80 and ensures it's running

# Install nginx if not already installed
apt-get update -y
apt-get install -y nginx

# Stop Apache if running (it might be blocking port 80)
if pgrep apache2; then
    service apache2 stop
    apt-get remove -y apache2
fi

# Start Nginx
service nginx start

# Wait a bit to ensure nginx starts fully
sleep 1

# Count number of processes listening on port 80
ss -ltnp | grep ':80' | wc -l
