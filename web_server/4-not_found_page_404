#!/usr/bin/env bash
# 4-not_found_page_404

# Update & install nginx
apt-get update -y
apt-get install -y nginx

# Create custom 404 page with the required content
echo "Ceci n'est pas une page" > /var/www/html/custom_404.html

# Backup the original config if no backup exists yet
if [ ! -f /etc/nginx/sites-available/default.bak ]; then
  cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.bak
fi

# Remove any existing error_page 404 lines to avoid duplicates
sed -i '/error_page 404/d' /etc/nginx/sites-available/default

# Insert error_page directive inside the server block (after server_name line)
sed -i '/server_name _;/a \    error_page 404 /custom_404.html;' /etc/nginx/sites-available/default

# Add location block for custom_404.html if it doesn't exist
if ! grep -q "location = /custom_404.html" /etc/nginx/sites-available/default; then
  sed -i '/server_name _;/a \
    location = /custom_404.html {\
        internal;\
    }' /etc/nginx/sites-available/default
fi

# Restart nginx using service command
service nginx restart
